<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - NNP Christian Union</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-green: #318b2e;
            --deep-green: #2a6f19;
            --secondary-orange: #f59e0b;
            --warm-orange: #f8c007;
            --bg-light: #f9fafb;
            --text-gray: #6b7280;
            --rich-black: #0B0B0B;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--rich-black);
            overflow-x: hidden;
        }

        .hero-gallery {
            background: linear-gradient(135deg, var(--deep-green) 0%, var(--primary-green) 100%);
            padding: 100px 0 60px;
            text-align: center;
        }

        .category-filter {
            background: white; padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 100;
        }

        .filter-btn {
            padding: 0.6rem 1.2rem; border: 2px solid var(--primary-green);
            background: white; color: var(--primary-green);
            border-radius: 50px; font-weight: 600; margin: 0.3rem; transition: 0.3s;
        }

        .filter-btn.active, .filter-btn:hover {
            background: var(--primary-green); color: white;
        }

        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem; padding: 2rem 0;
        }

        .gallery-item {
            position: relative; overflow: hidden; border-radius: 16px;
            aspect-ratio: 4/3; background: #e5e7eb; cursor: pointer; transition: 0.3s;
        }

        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .gallery-item:hover img { transform: scale(1.1); }

        .gallery-overlay {
            position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 1rem; color: white; opacity: 0; transition: 0.3s;
        }

        .gallery-item:hover .gallery-overlay { opacity: 1; }

        .video-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .video-thumbnail { position: relative; padding-top: 56.25%; }
        .video-thumbnail iframe { position: absolute; top:0; left:0; width:100%; height:100%; }

        .lightbox {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 10000; align-items: center; justify-content: center;
        }
        .lightbox.active { display: flex; }
        .lightbox-content img { max-width: 90vw; max-height: 80vh; border-radius: 8px; }
        .lightbox-nav { position: absolute; top: 50%; background: white; border: none; width: 45px; height: 45px; border-radius: 50%; }
        .lightbox-prev { left: 20px; } .lightbox-next { right: 20px; }
        .lightbox-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2rem; background: none; border: none; cursor: pointer; }

        .download-btn {
            position: absolute; bottom: 20px; right: 20px; background: var(--secondary-orange);
            color: white; padding: 8px 20px; border-radius: 5px; text-decoration: none; font-weight: bold;
        }

        .spinner {
            border: 4px solid rgba(0,0,0,0.1); border-top: 4px solid var(--primary-green);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="header-placeholder"></div>

    <section class="hero-gallery text-white">
        <div class="container">
            <h1 class="display-4 fw-bold">Moments of Faith</h1>
            <p class="lead">Capturing God's work in NNP Christian Union</p>
        </div>
    </section>

    <section class="container py-5 text-center">
        <div class="card p-4 shadow-sm border-0">
            <h2>Prayer Retreat Photo Drive</h2>
            <p>View and download full-resolution photos from prayer retreat.</p>
            <a href="https://photos.app.goo.gl/mSXe9V46ydnDapKW6" target="_blank" class="btn btn-success btn-lg px-4">
                <i class="fab fa-google-drive me-2"></i> <strong> CLICK HERE TO OPEN PRAYER RETREAT ALBUM</strong>
            </a>
        </div>
    </section>

    <div class="category-filter">
        <div class="container d-flex flex-wrap justify-content-center">
            <button class="filter-btn active" data-category="all">All</button>
            <button class="filter-btn" data-category="worship">Worship</button>
            <button class="filter-btn" data-category="outreach">Outreach</button>
            <button class="filter-btn" data-category="Prayer retreat">Prayer retreat</button>
            <button class="filter-btn" data-category="fellowship">Fellowship</button>
            <button class="filter-btn" data-category="events">Events</button>
            <button class="filter-btn" data-category="mission">Missions</button>
        </div>
    </div>

    <section class="container py-4">
        <div id="loading" class="spinner"></div>
        <div id="gallery" class="gallery-grid"></div>
        <div id="empty-state" class="text-center py-5" style="display:none;">
            <i class="fas fa-image fa-3x mb-3 text-muted"></i>
            <p>No photos found in this category.</p>
        </div>
    </section>

    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center fw-bold mb-4">Latest Sermons</h2>
            <div id="video-grid" class="row g-4"></div>
        </div>
    </section>

    <div id="lightbox" class="lightbox">
        <button class="lightbox-close"><i class="fas fa-times"></i></button>
        <button class="lightbox-nav lightbox-prev"><i class="fas fa-chevron-left"></i></button>
        <button class="lightbox-nav lightbox-next"><i class="fas fa-chevron-right"></i></button>
        <div class="lightbox-content text-center">
            <img id="lightbox-img" src="">
            <div class="mt-3 text-white fw-bold" id="lightbox-caption"></div>
            <a href="#" id="download-link" class="download-btn" download><i class="fas fa-download me-2"></i>Download</a>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script>
        // CONFIGURATION
        const GITHUB_USERNAME = 'muregavictor-dev'; 
        const REPO_NAME = 'NNP-C-U';
        const IMAGE_BASE_PATH = 'images/gallary'; 

        // ADD YOUR VIDEO IDs HERE
        const videoData = [
            { id: '0eNXQHAthpQ', title: 'Makutano Mission', desc: 'Day 1 Highlights' },
            { id: 'dQw4w9WgXcQ', title: 'Sunday Service', desc: 'Worship and Word' }
        ];

        let allImages = [];
        let filteredImages = [];
        let currentIndex = 0;

        // Fetch Header & Footer
        function loadComponent(id, file) {
            fetch(file).then(r => r.text()).then(data => {
                document.getElementById(id).innerHTML = data;
            }).catch(err => console.error("Error loading component:", file));
        }

        async function loadImages() {
            const loading = document.getElementById('loading');
            const gallery = document.getElementById('gallery');
            
            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${IMAGE_BASE_PATH}`);
                if (!res.ok) throw new Error("Folder not found");
                const files = await res.json();
                
                files.forEach(file => {
                    if (file.name.match(/\.(jpg|jpeg|png|webp)$/i)) {
                        let category = 'other'; 
                        const nameLower = file.name.toLowerCase();
                        if (nameLower.includes('worship')) category = 'worship';
                        else if (nameLower.includes('outreach')) category = 'outreach';
                        else if (nameLower.includes('fellowship')) category = 'fellowship';
                        else if (nameLower.includes('prayer retreat')) category = 'prayer retreat';
                        else if (nameLower.includes('event')) category = 'events';
                        else if (nameLower.includes('mission')) category = 'mission';

                        allImages.push({
                            url: file.download_url,
                            category: category,
                            title: file.name.split('.')[0].replace(/[_-]/g, ' ')
                        });
                    }
                });
                renderGallery('all');
            } catch (err) {
                console.error("Image load error:", err);
            } finally {
                loading.style.display = 'none';
            }
        }

        function renderGallery(filter) {
            const gallery = document.getElementById('gallery');
            const empty = document.getElementById('empty-state');
            filteredImages = filter === 'all' ? allImages : allImages.filter(i => i.category === filter);
            
            if (filteredImages.length === 0) {
                gallery.innerHTML = ''; empty.style.display = 'block';
            } else {
                empty.style.display = 'none';
                gallery.innerHTML = filteredImages.map((img, idx) => `
                    <div class="gallery-item" onclick="openLightbox(${idx})">
                        <img src="${img.url}" loading="lazy">
                        <div class="gallery-overlay">
                            <span class="badge bg-warning text-dark mb-2">${img.category}</span>
                            <h5>${img.title}</h5>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderVideos() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = videoData.map(v => `
                <div class="col-md-6 col-lg-4">
                    <div class="video-card">
                        <div class="video-thumbnail">
                            <iframe src="https://www.youtube.com/embed/${v.id}" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="p-3">
                            <h6 class="fw-bold mb-1">${v.title}</h6>
                            <small class="text-muted">${v.desc}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openLightbox(index) {
            currentIndex = index;
            const img = filteredImages[index];
            document.getElementById('lightbox-img').src = img.url;
            document.getElementById('lightbox-caption').innerText = img.title;
            document.getElementById('download-link').href = img.url;
            document.getElementById('lightbox').classList.add('active');
        }

        // Global Event Listeners
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelector('.filter-btn.active').classList.remove('active');
                e.target.classList.add('active');
                renderGallery(e.target.dataset.category);
            });
        });

        document.querySelector('.lightbox-close').onclick = () => document.getElementById('lightbox').classList.remove('active');
        document.querySelector('.lightbox-next').onclick = () => openLightbox((currentIndex + 1) % filteredImages.length);
        document.querySelector('.lightbox-prev').onclick = () => openLightbox((currentIndex - 1 + filteredImages.length) % filteredImages.length);

        window.onload = () => {
            loadComponent('header-placeholder', 'header.html');
            loadComponent('footer-placeholder', 'footer.html');
            loadImages();
            renderVideos();
        };
    </script>
</body>
</html>


