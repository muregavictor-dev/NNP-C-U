<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - NNP Christian Union</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-green: #318b2e;
            --deep-green: #2a6f19;
            --secondary-orange: #f59e0b;
            --warm-orange: #f8c007;
            --bg-light: #f9fafb;
            --text-gray: #6b7280;
            --rich-black: #0B0B0B;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--rich-black);
            overflow-x: hidden;
        }

        /* Hero Section */
        .hero-gallery {
            background: linear-gradient(135deg, var(--deep-green) 0%, var(--primary-green) 100%);
            padding: 100px 0 60px;
            position: relative;
            text-align: center;
        }

        /* Category Filter Stickiness */
        .category-filter {
            background: white;
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .filter-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--primary-green);
            background: white;
            color: var(--primary-green);
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0.3rem;
            cursor: pointer;
        }

        .filter-btn.active, .filter-btn:hover {
            background: var(--primary-green);
            color: white;
            box-shadow: 0 4px 12px rgba(49, 139, 46, 0.3);
        }

        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 2rem 0;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            aspect-ratio: 4/3;
            background: #e5e7eb;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gallery-item:hover { transform: translateY(-5px); }

        .gallery-item img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.5s ease;
        }

        .gallery-item:hover img { transform: scale(1.1); }

        .gallery-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 1rem; color: white; opacity: 0; transition: 0.3s;
        }

        .gallery-item:hover .gallery-overlay { opacity: 1; }

        /* Video Cards */
        .video-card {
            background: white; border-radius: 16px; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); height: 100%;
        }
        .video-thumbnail { position: relative; padding-top: 56.25%; }
        .video-thumbnail iframe { position: absolute; top:0; left:0; width:100%; height:100%; }

        /* Lightbox */
        .lightbox {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.95); z-index: 10000;
            align-items: center; justify-content: center;
        }
        .lightbox.active { display: flex; }
        .lightbox-content img { max-width: 90vw; max-height: 80vh; border-radius: 8px; }
        
        .lightbox-nav {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: white; border: none; width: 45px; height: 45px; border-radius: 50%;
        }
        .lightbox-prev { left: 20px; }
        .lightbox-next { right: 20px; }
        .lightbox-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2rem; cursor: pointer; background: none; border: none; }
        
        .download-btn {
            position: absolute; bottom: 20px; right: 20px;
            background: var(--secondary-orange); color: white;
            padding: 8px 20px; border-radius: 5px; text-decoration: none; font-weight: bold;
        }

        .spinner {
            border: 4px solid rgba(0,0,0,0.1); border-top: 4px solid var(--primary-green);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 576px) {
            .gallery-grid { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
        }
    </style>
</head>
<body>

    <div id="header-placeholder"></div>

    <section class="hero-gallery text-white">
        <div class="container">
            <h1 class="display-4 fw-bold">Moments of Faith</h1>
            <p class="lead">Capturing God's work in NNP Christian Union</p>
        </div>
    </section>

    <div class="category-filter">
        <div class="container d-flex flex-wrap justify-content-center">
            <button class="filter-btn active" data-category="all">All</button>
            <button class="filter-btn" data-category="worship">Worship</button>
            <button class="filter-btn" data-category="outreach">Outreach</button>
            <button class="filter-btn" data-category="fellowship">Fellowship</button>
            <button class="filter-btn" data-category="events">Events</button>
            <button class="filter-btn" data-category="mission">Missions</button>
        </div>
    </div>

    <section class="container py-4">
        <div id="loading" class="spinner"></div>
        <div id="gallery" class="gallery-grid"></div>
        <div id="empty-state" class="text-center py-5" style="display:none;">
            <i class="fas fa-image fa-3x mb-3 text-muted"></i>
            <p>No photos found in this category.</p>
        </div>
    </section>

    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center fw-bold mb-4">Latest Sermons</h2>
            <div id="video-grid" class="row g-4"></div>
        </div>
    </section>

    <div id="lightbox" class="lightbox">
        <button class="lightbox-close"><i class="fas fa-times"></i></button>
        <button class="lightbox-nav lightbox-prev"><i class="fas fa-chevron-left"></i></button>
        <button class="lightbox-nav lightbox-next"><i class="fas fa-chevron-right"></i></button>
        <div class="lightbox-content text-center">
            <img id="lightbox-img" src="">
            <div class="mt-3 text-white fw-bold" id="lightbox-caption"></div>
            <a href="#" id="download-link" class="download-btn" download><i class="fas fa-download me-2"></i>Download</a>
        </div>
    </div>

    <script>
        // ==========================================
// CONFIGURATION FOR FLAT FOLDER
// ==========================================
const GITHUB_USERNAME = 'muregavictor-dev'; 
const REPO_NAME = 'NNP-C-U';
const IMAGE_BASE_PATH = 'images/gallary'; 

async function loadImages() {
    const loading = document.getElementById('loading');
    const gallery = document.getElementById('gallery');
    allImages = []; 

    try {
        // We only fetch the main folder once
        const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${IMAGE_BASE_PATH}`);
        
        if (!res.ok) throw new Error("Folder not found");
        
        const files = await res.json();
        
        files.forEach(file => {
            // 1. Check if it's an image
            if (file.name.match(/\.(jpg|jpeg|png|webp)$/i)) {
                
                // 2. Determine Category based on filename
                // If filename is 'worship_night.jpg', category becomes 'worship'
                let category = 'other'; 
                const nameLower = file.name.toLowerCase();
                
                if (nameLower.includes('worship')) category = 'worship';
                else if (nameLower.includes('outreach')) category = 'outreach';
                else if (nameLower.includes('fellowship')) category = 'fellowship';
                else if (nameLower.includes('event')) category = 'events';
                else if (nameLower.includes('mission')) category = 'mission';

                allImages.push({
                    url: file.download_url,
                    category: category,
                    title: file.name.split('.')[0].replace(/[_-]/g, ' ') // Cleans up 'worship_night' to 'worship night'
                });
            }
        });

        renderGallery('all');
        
    } catch (err) {
        console.error("Error loading images:", err);
    } finally {
        loading.style.display = 'none';
    }
}

        // 3. Render Gallery
        function renderGallery(filter) {
            const gallery = document.getElementById('gallery');
            const empty = document.getElementById('empty-state');
            
            filteredImages = filter === 'all' ? allImages : allImages.filter(i => i.category === filter);
            
            if (filteredImages.length === 0) {
                gallery.innerHTML = ''; empty.style.display = 'block';
            } else {
                empty.style.display = 'none';
                gallery.innerHTML = filteredImages.map((img, idx) => `
                    <div class="gallery-item" onclick="openLightbox(${idx})">
                        <img src="${img.url}" loading="lazy">
                        <div class="gallery-overlay">
                            <span class="badge bg-warning text-dark mb-2" style="width:fit-content">${img.category}</span>
                            <h5>${img.title}</h5>
                        </div>
                    </div>
                `).join('');
            }
        }

        // 4. Video Rendering
        function renderVideos() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = videoData.map(v => `
                <div class="col-md-6 col-lg-4">
                    <div class="video-card">
                        <div class="video-thumbnail">
                            <iframe src="https://www.youtube.com/embed/${v.id}" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="p-3">
                            <h6 class="fw-bold mb-1">${v.title}</h6>
                            <small class="text-muted">${v.desc}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 5. Lightbox Logic
        function openLightbox(index) {
            currentIndex = index;
            const img = filteredImages[index];
            document.getElementById('lightbox-img').src = img.url;
            document.getElementById('lightbox-caption').innerText = img.title;
            document.getElementById('download-link').href = img.url;
            document.getElementById('lightbox').classList.add('active');
        }

        // Event Listeners
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelector('.filter-btn.active').classList.remove('active');
                e.target.classList.add('active');
                renderGallery(e.target.dataset.category);
            });
        });

        document.querySelector('.lightbox-close').onclick = () => document.getElementById('lightbox').classList.remove('active');
        document.querySelector('.lightbox-next').onclick = () => openLightbox((currentIndex + 1) % filteredImages.length);
        document.querySelector('.lightbox-prev').onclick = () => openLightbox((currentIndex - 1 + filteredImages.length) % filteredImages.length);

        window.onload = () => { loadImages(); renderVideos(); };
    </script>
</body>
</html>

