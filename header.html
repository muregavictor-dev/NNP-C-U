<header class="sticky-top" id="top-header">
    <nav class="navbar navbar-expand-lg py-3" aria-label="Main Navigation">
        <div class="container-xl">
            <a class="navbar-brand text-deep-green fw-bold fs-4" href="#">
                NNP Christian Union
                <span class="d-block small text-soft-gray fw-light" style="margin-top: -5px;">Faith • Fellowship • Growth</span>
            </a>
            
            <div class="d-flex order-lg-3 align-items-center">
                <button class="btn btn-link me-2 p-0 position-relative text-deep-green" type="button" data-bs-toggle="offcanvas" data-bs-target="#notificationPanel" aria-controls="notificationPanel" aria-label="Notifications">
                    <svg ...>...</svg>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-gold" ...>1</span>
                </button>

                <button class="btn btn-gold d-none d-lg-block ms-3" data-bs-toggle="modal" data-bs-target="#membershipModal">Become a Member</button>

                <button class="navbar-toggler border-0 ms-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNav" aria-controls="offcanvasNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNav" aria-labelledby="offcanvasNavLabel">
                <div class="offcanvas-body">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="library.html">Library</a></li>
                        <li class="nav-item"><a class="nav-link" href="ministry.html">Ministries</a></li>
                        <li class="nav-item"><a class="nav-link" href="#live">Live</a></li>
                        <li class="nav-item"><a class="nav-link" href="gallery.html">Gallery</a></li>
                        <li class="nav-item"><a class="nav-link" href="contact.html">Contacts</a></li>
                    </ul>
                    <div class="d-lg-none mt-3">
                        <button class="btn btn-gold w-100" data-bs-toggle="modal" data-bs-target="#membershipModal">Become a Member</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<div class="offcanvas offcanvas-end" tabindex="-1" id="notificationPanel" aria-labelledby="notificationPanelLabel">
    </div>

<div class="modal fade" id="membershipModal" tabindex="-1" aria-labelledby="membershipModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <form id="membershipForm" class="row g-3">
                <div class="col-12 mt-4">
                    <button type="submit" class="btn btn-gold btn-lg fw-bold w-100">Submit & Receive Welcome Pack</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById("membershipForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    fullName: document.getElementById("memberFullName").value,
    studentID: document.getElementById("memberStudentID").value,
    email: document.getElementById("memberEmail").value,
    phone: document.getElementById("memberPhone").value,
    yearClass: document.getElementById("memberYearClass").value,
    groups: Array.from(document.querySelectorAll("input[name='groups[]']:checked")).map(cb => cb.value),
    testimony: document.getElementById("memberTestimony").value,
    consent: document.getElementById("consentCheck").checked
  };

  const submitBtn = e.target.querySelector("button[type='submit']");
  submitBtn.disabled = true;
  submitBtn.textContent = "Submitting...";

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbwrT0WvUq1FwHp-LsOWa7PxVe_Herzz7LFc2BV8_J1Uwzf79KM6iM8_PXORxmazSY7w/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    const result = await res.json();
    if (result.success) {
      alert("✅ " + result.message);
      e.target.reset();
      window.open(result.whatsappUrl, "_blank");
    } else {
      alert("❌ Error: " + result.error);
    }
  } catch (err) {
    alert("⚠️ Failed to connect. Please check your internet or contact admin.");
  }

  submitBtn.disabled = false;
  submitBtn.textContent = "Submit & Receive Welcome Pack";
});
</script>
